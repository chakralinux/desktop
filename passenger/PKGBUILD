#
# Apps packages for Chakra, part of chakra-project.org
#
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=passenger
pkgver=4.0.29
pkgrel=1
pkgdesc="mod_rails passenger"
arch=('x86_64')
url="http://www.modrails.com"
#http://rubyforge.org/frs/?group_id=5873
license=('GPL')
depends=('ruby' 'ruby-rack' 'curl')
makedepends=('apache')
install=passenger.install
options=('!emptydirs')
source=($pkgname-$pkgver.tar.gz::https://github.com/FooBarWidget/passenger/archive/release-$pkgver.tar.gz)
md5sums=('b86afb74044b5497985d3664e43d5721')

build(){
  cd $srcdir/passenger-release-$pkgver

#  sed -i 's/env python/env python2/' lib/phusion_passenger/wsgi/request_handler.py

  ./bin/passenger-install-apache2-module -a
  rake nginx
}

package() {
  cd $srcdir/passenger-release-$pkgver

  install -dm755 "$pkgdir/usr/lib/passenger/"
  cp -r * $pkgdir/usr/lib/passenger/

  install -dm755 "$pkgdir/usr/lib/httpd/modules"
  ln -sf "/usr/lib/passenger/libout/apache2/mod_passenger.so" "$pkgdir/usr/lib/httpd/modules/mod_passenger.so"
}

