#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

#
# package info
#
pkgname=tribe-partitionmanager
pkgver=0.2.95
pkgrel=1
pkgdesc="Tribe's partitionmanager"
url="http://git.chakra-project.org/chakra/"
license="GPL"
arch=('i686' 'x86_64')
depends=('kdebase-workspace' 'parted>=2.3' 'e2fsprogs' 'libatasmart')
replaces=('kdemod-tribe-partitionmanager')
makedepends=('cmake' 'automoc4' 'pkgconfig')
conflicts=('kdemod-tribe-partitionmanager' 'chakra-libpartitionmanager')
groups=('kde-uninstall')
options=('!splithdr' '!splitdbg')
source=("http://chakra-project.org/sources/tribe/tribe-${pkgver}.tar.gz")
md5sums=('ec4ff2afe5cdcd83ae288f67714272af')

#
# build function
#
build()
{
        cd "${srcdir}/chakra-tribe/lib/"

	cmake . -DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_SKIP_RPATH=ON \
		-DCMAKE_{SHARED,MODULE,EXE}_LINKER_FLAGS='-Wl,--no-undefined -Wl,--as-needed' || return 1

	msg "Starting make..."
	make || return 1

	msg "Make successful, installing..."
	make DESTDIR=$startdir/pkg install || return 1

	# remove nasty files
	find $startdir/pkg/ -name ".git" -type d -exec rm -fr {} +
	# fix file conflicts
	rm -v $startdir/pkg/usr/share/icons/hicolor/128x128/apps/partitionmanager.png
	rm -v $startdir/pkg/usr/share/icons/hicolor/16x16/apps/partitionmanager.png
	rm -v $startdir/pkg/usr/share/icons/hicolor/22x22/apps/partitionmanager.png
	rm -v $startdir/pkg/usr/share/icons/hicolor/32x32/apps/partitionmanager.png
	rm -v $startdir/pkg/usr/share/icons/hicolor/48x48/apps/partitionmanager.png
	rm -v $startdir/pkg/usr/share/icons/hicolor/64x64/apps/partitionmanager.png

}