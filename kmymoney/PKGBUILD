# Maintainer: abveritas@chakra-project.org

pkgname=kmymoney
pkgver=4.6.3
pkgrel=3
pkgdesc="An finance manager for KDE4 with HBCI support"
arch=('x86_64')
url="http://kmymoney2.sourceforge.net"
license=('GPL')
depends=('kde-workspace' 'aqbanking-qt4' 'shared-mime-info' 'boost-libs' 'pulseaudio'
         'libofx' 'alkimia')
makedepends=('cmake' 'automoc4' 'gwenhywfar' 'docbook-xsl' 'boost' 'doxygen')
provides=()
conflicts=(kmymoney2)
replaces=(kmymoney2)
categories=('office')

source=("http://sourceforge.net/projects/kmymoney2/files/KMyMoney-KDE4/$pkgver/$pkgname-$pkgver.tar.bz2" "git-fixes.diff")
sha1sums=('52faa3938c77b1ef513d1a46f5545ed823595c51'
          '0b6876cee094b90083400f1de36e162b6617d9aa')

prepare() {
  cd "${srcdir}/${pkgname}-${pkgver}"

  patch -Np1 -i ../git-fixes.diff
}

build() {
  cd ${srcdir}/$pkgname-$pkgver

  cmake -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_BUILD_TYPE=RELEASE \
        -DCMAKE_SKIP_RPATH=YES \
        -DKDE4_BUILD_TESTS=OFF
  make VERBOSE=1
}

package() {
  cd ${srcdir}/$pkgname-$pkgver

  make DESTDIR=${pkgdir} install
}
