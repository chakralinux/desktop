#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf




pkgname=aqpm2-git
pkgver=20100524
pkgrel=1
pkgdesc="Qt wrapper around pacman's libalpm"
arch=('i686' 'x86_64')
url="http://chakra-project.org/tools-shaman.html"
license=('GPL')
depends=('pacman>3.3' 'pacman<3.4' 'polkit-qt' 'qjson' 'kdelibs>=4.4.0')
makedepends=('cmake' 'automoc4')
options=('splitdbg' '!splithdr')
groups=('kde-uninstall')
conflicts=("aqpm" "kdemod-aqpm" "kdemod-playground-aqpm-git" "kdemod-aqpm-git")
provides=("aqpm2")
#source=('FindPolkitQt.cmake')


_gitroot="git://git.chakra-project.org/tools/aqpm.git"
_gitname="aqpm"

build() {
	msg "Connecting to GIT server...."

	[ -d $_gitname ] && {
		cd $_gitname
		git pull origin
		cd ..

		msg "Local files have been updated."
	} || {
		git clone $_gitroot
	}

	msg "GIT checkout done or server timeout"

	rm -rf $_gitname-build
	git clone $_gitname $_gitname-build
	cd $_gitname-build

	# FIXME polkitqt1 temp fix
	# cp -fv ${srcdir}/FindPolkitQt.cmake ${srcdir}/$_gitname-build/cmake/modules/FindPolkitQt.cmake

	# FIXME there is no examples folder
	sed -i -e 's%add_subdirectory(examples)% %' ${srcdir}/$_gitname-build/libaqpm/CMakeLists.txt

	msg "Starting make..."

	cmake . -DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_AQPM_AUR=ON \
                -DKDE4_INTEGRATION=ON \
		-DCMAKE_BUILD_TYPE=${_build_type} || return 1
	make || return 1
	make DESTDIR=$pkgdir install
	#install aursearcher
	mkdir -p $pkgdir/usr/bin
	cp -v libaqpmaur/example/aursearcher $pkgdir/usr/bin
}

