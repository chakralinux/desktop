#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>
# contributor (x86_64): AlmAck <gluca86[at]google[dot]com>

pkgname=backintime-kde
pkgver=1.0.28
_bzrversion=881
pkgrel=1
pkgdesc="Back In Time is a simple backup system for Linux inspired from 'flyback project' and 'TimeVault'. KDE 4 version"
arch=('x86_64')
url="https://launchpad.net/backintime"
license="GPL"
depends=('rsync' 'cron' 'python' 'xorg-utils' 'python2-pyqt4' 'kdebindings-python2' 'python2-keyring')
makedepends=('bzr')
categories=('utils' 'backup')
#source=("http://backintime.le-web.org/wp-content/uploads/2009/03/backintime-${pkgver}.tar.gz"
source=('fix_spaces_in_anacron_jobs.patch')
sha256sums=('01a43ba204ee91de1490bc9670466c62fd6974d3eea06f77097f43bc59c34b1b')

_bzrbranch=lp:backintime 
_bzrmod=trunk

prepare() {
  msg "Connecting to the server...."

  if [[ -d "$_bzrmod" ]]; then
    cd "$_bzrmod" && bzr pull "$_bzrbranch" -r "$_bzrversion"
    msg "The local files are updated."
  else
    #bzr branch "$_bzrbranch" -q -r "$_bzrversion"
    bzr branch ${_bzrbranch} ${_bzrmod} -q -r ${_bzrversion}
  fi
 
  msg "BZR checkout done or server timeout"

}

build() {
msg "Starting make..."
  
  cd "${srcdir}/$_bzrmod/common"
  ./configure
  make

  cd "${srcdir}/$_bzrmod/kde4"
  ./configure
  make
}

package(){
  cd "${srcdir}/$_bzrmod/common"
  make DESTDIR="${pkgdir}" install
  sed -i -e 's/python/python2/g' "${pkgdir}/usr/bin/backintime"
  
  cd "${srcdir}/$_bzrmod/kde4"
  make DESTDIR="${pkgdir}" install
  sed -i -e 's/python/python2/g' "${pkgdir}/usr/bin/backintime-kde4"
}
