#
# Games Packages for Chakra, part of chakra-project.org
#
# Maintainer: Adrián Chaves Fernández (Gallaecio) <adriyetichaves@gmail.com>

pkgname=flare
pkgver=0.15.1
_developer=clintbellanger
_code=e0debc9
pkgrel=1
pkgdesc="Action roleplaying game from an isometric perspective."
arch=('i686' 'x86_64')
url="http://clintbellanger.net/rpg/"
license=('GPL2' 'CCPL-by-sa')
depends=('sdl' 'sdl_image' 'sdl_mixer' 'sdl_ttf')
replaces=('osare')
categories=('games')
changelog=ChangeLog
source=($pkgname-$pkgver.tar.gz::https://github.com/$_developer/$pkgname/tarball/v$pkgver)
md5sums=('bb8eff66aa999fc7fd520c6c3772451f')

build() {
  cd $srcdir/$_developer-$pkgname-$_code

  # Some CMake changes.
  sed -i -e "s#share/games#share#" -e "s#/games#/bin#" CMakeLists.txt
 
  # Executable compilation.
  mkdir build && cd build
  cmake \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=Release \
    -DBINDIR=bin \
    -DDATADIR=share/$pkgname \
    ..
  make
}

package() {
  cd $srcdir/$_developer-$pkgname-$_code/build
  make DESTDIR=$pkgdir install
 
  # Move executable (only way for it to work).
#   mv $pkgdir/usr/bin/$pkgname $pkgdir/usr/share/$pkgname/$pkgname
 
  # Execution script.
#   cat > $pkgdir/usr/bin/$pkgname << EOF
# #!/bin/sh
# cd /usr/share/$pkgname/
# ./$pkgname
# EOF
#   chmod -R +x $pkgdir/usr/bin/$pkgname
 
  # Documentation.
  install -Dm644 $srcdir/$_developer-$pkgname-$_code/README $pkgdir/usr/share/doc/$pkgname/readme.txt
}
