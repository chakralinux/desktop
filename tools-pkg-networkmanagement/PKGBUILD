#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf


#
# package info
#
pkgname=('networkmanagement')
         
arch=('i686' 'x86_64')
pkgver=1173597
pkgrel=1

pkgdesc="KDE SC networkmanager plasmoid"
url="http://plasma.kde.org"
license=('GPL')

options=('force')

depends=("kdelibs>=${_kdever}" "kdebase-workspace>=${_kdever}" 'networkmanager>=0.8.1')
makedepends=('subversion' 'cmake' 'python' 'automoc4')
replaces=('networkmanagement-networkmanager-plasmoid' 'networkmanagement-knetworkmanager-kde4')

# comment out when using stable snapshot
#_svntrunk=svn://anonsvn.kde.org/home/kde/trunk/extragear/base/networkmanagement
#_svnmod=networkmanagement


#
# build function
#
build() {
cd "$srcdir"

	# comment out when using stable snapshot
	#svn co $_svntrunk $_svnmod --revision $pkgver
	svn co svn://anonsvn.kde.org/home/kde/trunk/extragear/base/networkmanagement --revision $pkgver
	msg "SVN checkout done or server timeout"

	mkdir -p $srcdir/build
	cd $srcdir/build
	
	cmake ../networkmanagement -DCMAKE_INSTALL_PREFIX=${_installprefix} \
			  -DDBUS_SYSTEM_POLICY_DIR=/etc/dbus-1/system.d \
			  -DCMAKE_BUILD_TYPE=${_build_type} \
			  -DCMAKE_SKIP_RPATH=ON \
			  -DINSTALL_KNM_AUTOSTART=OFF \
			  -DCMAKE_{SHARED,MODULE,EXE}_LINKER_FLAGS='-Wl,--no-undefined -Wl,--as-needed'
	make || return 1
	
	make DESTDIR=${pkgdir} install || return 1
}
