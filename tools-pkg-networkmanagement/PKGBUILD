#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

#
# package info
#
pkgname=('networkmanagement')
         
arch=('i686' 'x86_64')
pkgver=20110717
pkgrel=2

pkgdesc="KDE SC networkmanager plasmoid"
url="http://plasma.kde.org"
license=('GPL')

options=('force')

depends=("kdelibs" "kde-workspace" 'networkmanager>=0.8.4')
makedepends=('subversion' 'cmake' 'python' 'automoc4' 'mobile-broadband-provider-info')
optdepends=('mobile-broadband-provider-info: allow to add new mobile connection')
replaces=('networkmanagement-networkmanager-plasmoid' 'networkmanagement-knetworkmanager-kde4')

install=${pkgname}.install
source=("http://chakra-project.org/sources/${pkgname}/${pkgname}-${pkgver}.tar.xz")
md5sums=('2cdb00adcca86652f2ddc55cdc3fdfed') # networkmanagement-20110717.tar.xz

# create tarball: source PKGBUILD && mksource

mksource() {
	  rm -vRf ${pkgname}
	  git clone git://anongit.kde.org/${pkgname}
	  cd ${pkgname}
	  git checkout ${pkgver}
	  cd ..
	  rm -vRf ${pkgname}/.git
	  pushd ${pkgname}
	  popd
	  tar -cvJf ${pkgname}-${pkgver}.tar.xz ${pkgname}/*
	  md5sum ${pkgname}-${pkgver}.tar.xz
}

#
# build function
#
build() {
  cd "${srcdir}"
  mkdir build
  cd build
  cmake ../networkmanagement \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=Release \
    -DDBUS_SYSTEM_POLICY_DIR=/etc/dbus-1/system.d
  make
}

package() {
  cd ${srcdir}/build
  make DESTDIR=${pkgdir} install
}
