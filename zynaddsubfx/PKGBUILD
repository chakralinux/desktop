# Maintainer: Daniele Cocca <jmc@chakra-project.org>
# Contributor: Ernesto Manr√≠quez <alejandronova@gmail.com>

#_pkgname=ZynAddSubFX
pkgname=zynaddsubfx
pkgver=2.4.4
pkgrel=1
pkgdesc="Open source additive and substractive software synthesizer, with an integrated effect engine."
arch=('x86_64')
url="http://zynaddsubfx.sourceforge.net/"
license=('GPL2')
depends=('fftw' 'mxml' 'zlib' 'fltk' 'lash' 'dssi')
makedepends=('oss' 'jack' 'ladspa')
source=("https://downloads.sourceforge.net/project/${pkgname}/${pkgname}/${pkgver}/${pkgname}-${pkgver}.tar.xz"
#        'gentoo-zynaddsubfx-2.4.1-docs.patch'
)
categories=('multimedia')
sha256sums=('a3b8d24780ce65c47a402b38a99563186863550fe1ff40d11e4ed57211f87e95')

build() {
  # Patch it first
#  cd "${srcdir}/${pkgname}-${pkgver}"

#  patch -Np1 -i "${srcdir}/gentoo-zynaddsubfx-2.4.1-docs.patch"

  # Then, prepare the build directory
  cd "${srcdir}"
  
  [ ! -d build ] && mkdir -p build

  # Then, actually build it
  cd build
  
  cmake "${srcdir}/${pkgname}-${pkgver}" \
        -DCMAKE_BUILD_TYPE=RelWithDebInfo \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DGuiModule=fltk \
        -DDssiEnable=true
  
  make
}

package() {
  cd "${srcdir}/build"
  make DESTDIR="${pkgdir}" install

  # Also copy the data files...
  install -d -m755 "${pkgdir}/usr/share/${pkgname}"
  cp -a "${srcdir}/${pkgname}-${pkgver}/instruments/banks" "${pkgdir}/usr/share/${pkgname}"
  cp -a "${srcdir}/${pkgname}-${pkgver}/instruments/examples" "${pkgdir}/usr/share/${pkgname}"
}
