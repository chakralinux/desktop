#
# Apps Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

# This is a quite complicated version searching
# pkgfolder is the folder containing the tarballs in the blender server
# pkgsubver is used for pre-releases or alpha versions.  
pkgname=blender-bin
pkgver=2.5
pkgrel=3
pkgsubver=alpha2
pkgfolder=2.50alpha


pkgdesc="A fully integrated 3D graphics creation suite (binary version)"
arch=('i686' 'x86_64')
url="http://blender.org/"
license=('GPL')
depends=('libgl' 'libpng12' 'libjpeg6' 'libx11' 'libxau' 'libxcb' 'libxdamage' 'libxdmcp' 'libxext' 'libxfixes' 'libxi' 'libxxf86vm' 'python' 'sdl' 'zlib')
makedepends=('librsvg')
provides=('blender')
conflicts=('blender')
install=blender.install
source=('blender.desktop')
md5sums=('b5b9720b9430b1f5e2aa0b2df533fed8')

case ${CARCH} in
  i686)
  source=(${source[@]} "http://video.blendertestbuilds.de/download.blender.org/release/Blender${pkgfolder}/blender-${pkgver}-${pkgsubver}-linux-glibc27-i686.tar.bz2")
    md5sums=(${md5sums[@]} '48f4ef6fc59b9fa0926e3b072b2ad6e6');;
  x86_64)
  #Fixme: please add the correct md5sums for x86_64, not tested yet!
  source=(${source[@]} "http://video.blendertestbuilds.de/download.blender.org/release/Blender${pkgfolder}/blender-${pkgver}-${pkgsubver}-linux-glibc27-x86_64.tar.bz2")
    md5sums=(${md5sums[@]} '58822737042a0bd220553ac78994722f');;
esac

build() {
  mkdir -p $pkgdir/usr/{share/blender,share/icons/hicolor,bin}
  case ${CARCH} in
    i686)
      cd $srcdir/blender-${pkgver}-${pkgsubver}-linux-glibc27-i686
      ;;
    x86_64)
      cd $srcdir/blender-${pkgver}-${pkgsubver}-linux-glibc27-x86_64
      ;;
  esac

  cp -r .blender/locale $pkgdir/usr/share
  cp -r .blender/scripts $pkgdir/usr/share/blender
  cp -r .blender/python $pkgdir/usr/share/blender
  cp -r icons/* $pkgdir/usr/share/icons/hicolor 
  cp blender $pkgdir/usr/bin
  cp blender-softwaregl $pkgdir/usr/bin

  # stolen from blender in extra
  install -Dm644 $srcdir/blender.desktop $pkgdir/usr/share/applications/blender.desktop
}

