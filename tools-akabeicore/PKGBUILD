#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf


#
# package info
#
pkgname=akabeicore
pkgver=20100524
pkgrel=1
pkgdesc="Akabeiâ€™s core library"
url="http://git.chakra-project.org/chakra/"
license="GPL"
arch=('i686' 'x86_64')
depends=('sqlite3' 'qt' 'libarchive')
makedepends=('cmake')
options=('!splithdr' 'splitdbg')

groups=('kde-uninstall')

_gitroot="git://git.chakra-project.org/akabei/akabeicore.git"
_gitname="akabeicore"

#
# build function
#
build()
{
        cd "${srcdir}"
        msg "Connecting to GIT server...."

        if [ -d $_gitname ] ; then
        cd $_gitname && git pull
        msg "The local files are updated."
        else
	      git clone $_gitroot
        fi
        msg "GIT checkout done or server timeout"
        msg "Starting make..."

        rm -rf "${srcdir}/$_gitname-build"

        cp -r "${srcdir}/$_gitname" "${srcdir}/$_gitname-build"
        cd "${srcdir}/$_gitname-build/"

	cmake . -DCMAKE_INSTALL_PREFIX=${_installprefix} \
		-DCMAKE_BUILD_TYPE=${_build_type} \
		-DCMAKE_SKIP_RPATH=ON \
		-DCMAKE_{SHARED,MODULE,EXE}_LINKER_FLAGS='-Wl,--no-undefined -Wl,--as-needed' || return 1

	msg "Starting make..."
	make || return 1

	msg "Make successful, installing..."
	make DESTDIR=$startdir/pkg install || return 1

	# remove nasty files
	find $startdir/pkg/ -name ".git" -type d -exec rm -fr {} +
}