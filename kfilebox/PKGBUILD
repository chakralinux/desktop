# Maintainer: Neophytos Kolokotronis <tetris AT @gmail DOT com>
# Contributions from AUR: https://aur.archlinux.org/packages/kfilebox/

pkgname=kfilebox
pkgver=0.4.9
pkgrel=3
pkgdesc="KDE4 Dropbox client (with own daemon)"
arch=('x86_64')
url="http://kdropbox.deuteros.es"
license=('GPL')
depends=('kde-workspace' 'gettext')
provides=('dropbox')
replaces=('kfilebox-gtkfree')
categories=('network' 'backup' 'cloud')
source=(${pkgname}-${pkgver}.tar.gz::http://downloads.sourceforge.net/project/kdropbox/kfilebox-${pkgver}/Source/${pkgname}_${pkgver}.tar.gz)
install=${pkgname}.install
noextract=(${pkgname}-${pkgver}.tar.gz})
md5sums=('4b40b7a2e52c0d3d126dd4f8c404efdd')

prepare() {
    cd "$srcdir"
    gunzip -f "${pkgname}-${pkgver}.tar.gz"
    mv "${pkgname}-${pkgver}.tar" "${pkgname}-${pkgver}.tar.gz"
    tar fxvz "${pkgname}-${pkgver}.tar.gz"
}

build() {
    cd "${srcdir}/${pkgname}_${pkgver}" 
    qmake
    make
}

package() {
    cd "${srcdir}/${pkgname}_${pkgver}"
    msg 'install binary'
    install -Dm 755 "${srcdir}/${pkgname}_${pkgver}/bin/kfilebox" "${pkgdir}/usr/bin/kfilebox"
    msg 'create data directory'
    install -dm 755 "${pkgdir}/usr/share/kfilebox"
    msg 'copy all icons'
    cp -pr "${srcdir}/${pkgname}_${pkgver}/img/"* "${pkgdir}/usr/share/kfilebox"
    msg 'install notifyrc file'
    install -Dm 644 "${srcdir}/${pkgname}_${pkgver}/kfilebox.notifyrc" "${pkgdir}/usr/share/apps/kfilebox/kfilebox.notifyrc"
    msg 'install desktop file'
    install -Dm 644 "${srcdir}/${pkgname}_${pkgver}/kfilebox.desktop" "${pkgdir}/usr/share/applications/kde4/kfilebox.desktop"
    msg 'install locales'
    for language in `ls "${srcdir}/${pkgname}_${pkgver}/locale"`
    do
      if [ -e ${srcdir}/${pkgname}_${pkgver}/locale/$language/kfilebox.mo ]; then
	install -Dm 644 ${srcdir}/${pkgname}_${pkgver}/locale/$language/kfilebox.mo ${pkgdir}/usr/share/locale/$language/LC_MESSAGES/kfilebox.mo
      fi
    done
}

