#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>
# (c) 2010 Drake Justice

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=cinstall
pkgver=20100704
<<<<<<< HEAD
pkgrel=4
=======
pkgrel=3
>>>>>>> 8e03ff0acf86c6956d28fb9198ba5930fc69f0aa
depends=('kdelibs' 'qt' 'squashfs-tools' 'xz-utils')
pkgdesc="Drake Justice's Bundle Creator/Launcher and Package-Manager"
arch=("i686" "x86_64")
license=('GPL')
install=$pkgname.install
url="http://chakra-project.org/"
optdepends=('akabei: for akabei support'
            'pacman: for pacman support')

<<<<<<< HEAD
#sources=("cinstall-0704-3-fixdesktopfile.patch")
#md5sums=("decf4d7e9a091e07e954062df7211f9a")
=======
sources=("cinstall-0704-3-fixdesktopfile.patch")
md5sums=("decf4d7e9a091e07e954062df7211f9a")
>>>>>>> 8e03ff0acf86c6956d28fb9198ba5930fc69f0aa


_gitroot="git://gitorious.org/cinstall/cinstall.git"
_gitname="cinstall"

build() {
cd "${srcdir}"
        msg "Connecting to GIT server...."

        if [ -d $_gitname ] ; then
        cd $_gitname && git pull
        msg "The local files are updated."
        else
	      git clone $_gitroot
	      cd $_gitname && git checkout
        fi
        msg "GIT checkout done or server timeout"

        msg "Starting make..."

        rm -rf "${srcdir}/$_gitname-build"

        cp -r "${srcdir}/$_gitname" "${srcdir}/$_gitname-build"
        cd "${srcdir}/$_gitname-build/"

<<<<<<< HEAD
#        msg "patch source"
#	patch -Np1 -i ${startdir}/cinstall-0704-3-fixdesktopfile.patch || return 1
=======
        msg "patch source"
	patch -Np1 -i ${startdir}/cinstall-0704-3-fixdesktopfile.patch || return 1
>>>>>>> 8e03ff0acf86c6956d28fb9198ba5930fc69f0aa

        cmake ../$_gitname-build \
          -DCMAKE_INSTALL_PREFIX=/usr \
          -DCMAKE_BUILD_TYPE=Release
        make || return 1
        make DESTDIR=${pkgdir} install || return 1
}

