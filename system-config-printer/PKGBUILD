# Support packages for Desktop
#
# Maintainer: Manuel Tortosa <manutortosa@chakra-project.org>

pkgname="system-config-printer"
pkgver=1.4.0
pkgrel=2
pkgdesc="A CUPS printer configuration tool and status applet"
url="http://cyberelk.net/tim/software/system-config-printer/"
arch=('any')
license=('GPL')
depends=('pycups' 'dbus-python' 'pysmbc' 'libusb-compat' 'python-pycurl')
makedepends=('intltool' 'python2' 'xmlto' 'docbook-xsl' 'desktop-file-utils' 'libcups' 'libxml2')
optdepends=('kdeadmin-print-manager: for the administration tool in KDE System Settings')
provides=('system-config-printer-common')
source=(http://cyberelk.net/tim/data/${pkgname}/1.4/${pkgname}-${pkgver}.tar.xz{,.sig})
md5sums=('3267c2eac454f470c0659034196d2668'
         'bbd7884b13824713ab683418d26f6cb6')


build() {
  cd "${srcdir}"/${pkgname}-${pkgver}

  sed -i -e "s|#![ ]*/usr/bin/python$|#!/usr/bin/python2|" \
    -e "s|#![ ]*/usr/bin/env python$|#!/usr/bin/env python2|" \
    $(find . -name '*.py')
  sed -i "s|#!/usr/bin/python|#!/usr/bin/python2|" udev/udev-add-printer

  ./configure --prefix=/usr \
    --sbindir=/usr/bin \
    --sysconfdir=/etc \
    --with-udev-rules

  make
}

package() {
  cd ${pkgname}-${pkgver}
  make DESTDIR="${pkgdir}" install

  sed -i -e "s~#!/bin/sh~#!/bin/sh\nexport GI_TYPELIB_PATH=/extra/usr/lib/girepository-1.0/~g" ${pkgdir}/usr/bin/system-config-printer
}
