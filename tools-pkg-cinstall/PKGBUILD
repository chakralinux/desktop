#
# Chakra Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>
# (c) 2010 Drake Justice

pkgname=cinstall
pkgver=0.3.51
pkgrel=1
depends=('squashfs-tools' 'xz>=5.0.0' 'fakechroot' 'unionfs-fuse')
makedeps=('kdelibs' 'qt')
pkgdesc="Bundle Creator/Launcher and Package-Manager"
arch=("i686" "x86_64")
license=('GPL')
install=$pkgname.install
url="http://chakra-project.org/"
optdepends=('akabei: for akabei support'
            'pacman: for pacman support')

source=("http://chakra-project.org/sources/cinstall/cinstall-$pkgver-${pkgrel}.tar.gz")
md5sums=('7f62317d0fbc99d5510a3e1288658212')

# create tarball: source PKGBUILD && mksource

mksource() {
	  rm -vRf cinstall
	  git clone git://gitorious.org/${pkgname}/${pkgname}.git
	  rm -vRf ${pkgname}/.git
	  sed -i -e "s~\"0.3.0\", ki18n(\"Chakra Software Manager\"),~\"$pkgver\", ki18n(\"Chakra Software Manager\"),~g" ${pkgname}/main.cpp
	  pushd ${pkgname}
	  popd
	  tar -cvJf ${pkgname}-${pkgver}-${pkgrel}.tar.xz ${pkgname}/*
	  md5sum ${pkgname}-${pkgver}-${pkgrel}.tar.xz
}

build() {
        mkdir -p $srcdir/build
        cd $srcdir/build

        cmake ../cinstall \
          -DCMAKE_INSTALL_PREFIX=/usr \
          -DCMAKE_BUILD_TYPE=Release
        make || return 1
}

package() {
        cd $srcdir/build
        make DESTDIR=${pkgdir} install || return 1
}
