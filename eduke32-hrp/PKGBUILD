#
# Games Packages for Chakra, part of chakra-project.org
#
# Maintainer: Daniele Cocca <daniele.cocca@gmail.com>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=eduke32-hrp
pkgver=4.1.1
pkgrel=1
pkgdesc="High-resolution textures, 3D models and OGG Vorbis soundtrack for EDuke32"
arch=('any')
url="http://hrp.duke4.net/"
license=('custom:HRP Art' 'custom:CGTextures')
depends=('eduke32>=20081121')
conflicts=('duke3d-hrp')
source=("http://www.duke4.org/files/hrp/dn3d_hrp-4.0(321).zip" \
	"http://www.duke4.org/files/nightfright/eduke32_mus.zip" \
	"CGTextures.license" \
	"http://www.duke4.org/files/nightfright/xxx_lite.zip" \
	"http://www.duke4.org/files/nightfright/hrp_update.zip" \
	"http://www.duke4.org/files/nightfright/maphacks.zip")
noextract=(xxx_lite.zip eduke32_mus.zip hrp_update.zip maphacks.zip)
md5sums=('01ec2c1d9be94bcb556c910814f2b85f'
         '2b6fd9c1b69fc5f6e895b27bf6b02cd1'
         '82167693ec2467aa5fa5c418a4a5f207'
         '66d04e5bfc77ac3e11414951f113cb33'
         'd773c6c19cec58b63428fd3807fba10a'
         'ad29ec947e8931ff8e7db07913cd3a71')

build() {
  msg "Extracting additional included zip files..."

  bsdtar -x -f autoload/duke3d.grp/duke3d_hrp.zip || return 1
  bsdtar -x -f eduke32_mus.zip || return 1
  bsdtar -x -f xxx_lite.zip || return 1
  bsdtar -x -f maphacks.zip || return 1
  bsdtar -x -f hrp_update.zip || return 1

  mkdir -p "${pkgdir}"/usr/share/eduke32
  cp -rf *.def *.mhk highres/ "${pkgdir}"/usr/share/eduke32/

  find "$pkgdir" -type f -exec chmod 644 {} \;

  install -Dm644 hrp_art_license.txt "${pkgdir}"/usr/share/licenses/${pkgname}/hrp_art_license.txt
  install -m644 CGTextures.license "${pkgdir}"/usr/share/licenses/${pkgname}/
}
