# Maintainer: Adrián Chaves Fernández (Gallaecio) <adriyetichaves gmail.com>

pkgname=supertuxkart-addons-karts
pkgver=0.7
pkgrel=1
pkgdesc="Additional karts for SuperTuxKart."
url="http://supertuxkart.sourceforge.net/"
arch=('any')
license=('GPL3' 'GPL2' 'CCPL-by' 'CCPL-by-sa' 'custom:Creative Commons Sampling Plus 1.0' 'custom:FreeArt License' 'custom:SoundSnap license' 'custom:Public Domain')
depends=('supertuxkart>=0.7')
makedepends=('unzip')
conflicts=('supertuxkart-svn')
source=("http://download.tuxfamily.org/stkaddons/file/karts/Bigbuckbunny [Irrlicht-0.7].zip"
	"http://download.tuxfamily.org/stkaddons/file/karts/Chinchila [Irrlicht-0.7].zip"
	"http://download.tuxfamily.org/stkaddons/file/karts/Chuck [Irrlicht-0.7].zip"
	"http://download.tuxfamily.org/stkaddons/file/karts/Mr Ice Block.zip"
	"http://download.tuxfamily.org/stkaddons/file/karts/Plee the bear.zip"
	"http://download.tuxfamily.org/stkaddons/file/karts/Python Kart.zip")
md5sums=('08c1171bf5b464eb97b25ba68abd823c'
         '23337abc531889124ab3f8104d450cc8'
         '570d2debf448ba3db8fffe9c5688e170'
         '81aeb61dc4bc453c50d9048b4377e171'
         '815767328f87201adea377564280832c'
         '8954dba7ce6300db3eb1da00e049fc9f')

_addondir=$pkgdir/usr/share/games/supertuxkart/data/karts

build() {
  cd $srcdir
}

package() {
  cd $srcdir

  IFS=$'\n' # Needed for 'find' to work properly, don't know why.
  for addonfile in $(find -type l -printf "%f\n")
  do
    addon=${addonfile:0:${#addonfile}-4}
    install -d $_addondir/$addon
    cd $_addondir/$addon
    cp $srcdir/$addonfile $_addondir/$addon/
    unzip $addonfile
    rm $addonfile

    if [ $(find -maxdepth 1 -type f -printf "%f\n" | wc -l) == 0 ] ; then 
      # Content was in a subfolder.
      mv * ../
      rmdir $_addondir/$addon
    fi
  done
}
