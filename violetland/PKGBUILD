_pkgbase=violetland
pkgname=$_pkgbase-git
pkgver=0.5.r145.ga0c91d1
pkgrel=1
pkgdesc='Open source cross platform game where a girl, Violet, struggles with hordes of monsters (clone of "crimsonland").'
arch=('x86_64')
url="http://violetland.github.io"
license=('GPL3' 'CCPL:by-sa')
depends=('sdl_image' 'sdl_mixer' 'sdl_ttf' 'mesa' 'boost-libs')
makedepends=('cmake' 'boost' 'git')
conflicts=("$_pkgbase")
provides=("$_pkgbase")
source=($_pkgbase::"git+https://github.com/ooxi/violetland.git")
md5sums=('SKIP')

pkgver() {
  cd $_pkgbase
  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
  cd $_pkgbase

  # check out submodules
  git submodule init
  git submodule update
}

build() {
  cd $_pkgbase

  cmake ./ -DCMAKE_INSTALL_PREFIX=/usr
  make
}

package() {
  cd $_pkgbase

  make DESTDIR="$pkgdir/" install

  # .desktop entry
  install -Dm644 $_pkgbase.desktop "$pkgdir"/usr/share/applications/$_pkgbase.desktop
  install -Dm644 icon-light.png "$pkgdir"/usr/share/pixmaps/$_pkgbase.png
}
