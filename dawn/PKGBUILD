#
# Games Packages for Chakra, part of chakra-project.org
#
# Maintainer: Adrián Chaves Fernández (Gallaecio) <adriyetichaves gmail.com>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgname=dawn
_pkgname=dawn-rpg
pkgver=0.0.44
pkgrel=1
pkgdesc="2D RPG set in a fantasy world."
arch=('i686' 'x86_64')
license=('GPL3')
url="http://dawn-rpg.sourceforge.net/wiki"
depends=('sdl' 'sdl_image' 'sdl_mixer' 'libgl' 'mesa' 'freeglut' 'freetype2' 'lua' 'toluapp')
makedepends=('autoconf' 'automake')
replaces=('dawn-rpg')
changelog=ChangeLog
source=("http://downloads.sourceforge.net/project/$_pkgname/$_pkgname/$pkgname-$pkgver.tar.gz")
md5sums=('dac93b36f6d3e9af3aa401042e4f5bbd')

build()
{
  cd $srcdir/$_pkgname

# Emptied for this configuration (else you get a tolua++ fail):
  LDFLAGS="" \
  ./configure \
    --prefix=/usr
  make
}

package()
{
  cd $srcdir/$_pkgname
#   make DESTDIR=$pkgdir install

  install -Dm 775 $srcdir/$_pkgname/$_pkgname $pkgdir/usr/share/$pkgname/$pkgname
  cp -R $srcdir/$_pkgname/data $pkgdir/usr/share/$pkgname/data
  install $srcdir/$_pkgname/settings.lua $pkgdir/usr/share/$pkgname/settings.lua

  # Temporal launcher:
  mkdir -p $pkgdir/usr/bin
  echo "#!/bin/bash"				> $pkgdir/usr/bin/$pkgname
  echo "cd /usr/share/$pkgname"			>> $pkgdir/usr/bin/$pkgname
  echo "./$pkgname"				>> $pkgdir/usr/bin/$pkgname
  chmod +x $pkgdir/usr/bin/$pkgname

  # Change permissions so all users in "games" group can save games.
  chown :games $pkgdir/usr/share/$pkgname/ -R
  chmod 775 $pkgdir/usr/share/$pkgname/ -R
}
