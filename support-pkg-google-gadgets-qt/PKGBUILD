#
# KDE SC Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf



# original name (used for the source and pkgnames)
_origname=google-gadgets-qt



pkgname=${_origname}
pkgver=0.11.2
pkgrel=5
pkgdesc="Desktop Widgets (engine) from Google"
arch=(i686 x86_64)
url="http://code.google.com/p/google-gadgets-for-linux/"
license=('APACHE')
depends=('gstreamer0.10-base-plugins' 'librsvg' 'xulrunner>=2.0' "${_qtpkg}>=${_qtver}" 'desktop-file-utils' 'curl' 'spidermonkey')
makedepends=('zip' 'unzip')
options=('!libtool' '!splitdbg' '!splithdr')
conflicts=('google-gadgets-gtk' 'google-gadgets' 'google-gadgets-qt' 'google-gadgets-gtk-svn' 'google-gagdets-qt-svn')
replaces=('google-gadgets-qt')
install=${_origname}.install
source=(http://google-gadgets-for-linux.googlecode.com/files/google-gadgets-for-linux-$pkgver.tar.bz2
        ggl-qt.desktop
	plasma-stuff.tar.gz)
md5sums=('279305553bcbf74f3e3615f6abc36a5e'  # google-gadgets-for-linux-0.11.2.tar.bz2
         'e978e9ecb77d309403a72cadf42f0468'  # ggl-qt.desktop
         '49ec567c9513f2fe859e8ea605cdac80') # plasma-stuff.tar.gz

groups=("kde-uninstall" "kde-support")

build()
{
        cd "${srcdir}/google-gadgets-for-linux-$pkgver"

        ./configure --prefix=/usr \
                    --disable-werror \
                    --disable-update-desktop-database \
                    --disable-update-mime-database \
                    --disable-libggadget-gtk \
                    --disable-gtk-host \
                    --disable-gtk-system-framework \
                    --disable-gtkmoz-browser-element \
                    --disable-gtk-flash-element \
					--disable-smjs-script-runtime \
                    || return 1

        make || return 1
	
        make DESTDIR="${pkgdir}" install || return 1

        install -Dm0644 "${srcdir}/ggl-qt.desktop" "${pkgdir}/usr/share/applications/ggl-qt.desktop"

	mkdir -p ${pkgdir}/usr/share/apps/plasma/plasmoids/
	mkdir -p ${pkgdir}/usr/share/kde4/services/
	cp -R $srcdir/ggl_photos ${pkgdir}/usr/share/apps/plasma/plasmoids/
	cp -R $srcdir/ggl_rss ${pkgdir}/usr/share/apps/plasma/plasmoids/
	cp $srcdir/plasma-applet-ggl-photos.desktop ${pkgdir}/usr/share/kde4/services/
	cp $srcdir/plasma-applet-ggl-rss.desktop ${pkgdir}/usr/share/kde4/services/
}

