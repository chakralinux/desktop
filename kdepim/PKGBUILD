# Maintainer:   H W Tovetj√§rn (totte) <totte@tott.es>
# Contributors: Manuel Tortosa <manutortosa@chakra-project.org>
#               Andrea Scarpino <andrea@archlinux.org>
#               Pierre Schmitz <pierre@archlinux.de>

# Include global configuration
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

pkgbase='kdepim'
pkgname=('kdepim-common'
         'kdepim-akonadiconsole'
         'kdepim-akregator'
         'kdepim-blogilo'
         'kdepim-kaddressbook'
         'kdepim-kalarm'
         'kdepim-kjots'
         'kdepim-kleopatra'
         'kdepim-kmail'
         'kdepim-knode'
         'kdepim-knotes'
         'kdepim-kontact'
         'kdepim-korganizer'
         'kdepim-ktimetracker')
pkgver=${_kdever}
pkgrel=2
arch=('x86_64')
url="http://pim.kde.org"
license=('GPL'
         'LGPL'
         'FDL')
options=('!docs'
         '!header'
         'debug'
         'log')
makedepends=('pkg-config'
             'cmake'
             'automoc4'
             'boost'
             "kdelibs>=${_kdever}"
             "kdepimlibs>=${_kdever}"
             'grantlee>=0.3.0'
             "kdepim-runtime>=${_kdever}"
             'libxss'
             "kde-runtime>=${_kdever}"
             'libsamplerate'
             'qrencode'
             'libdmtx'
             "chakra-common>=${_kdever}"
             'docbook-xml'
             'dblatex'
             "baloo-widgets>=${_kdever}"
             'link-grammar')
source=($_mirror/${pkgbase}-${pkgver}.tar.xz)
sha256sums=(`grep ${pkgbase}-$_kdever.tar.xz  ../checksums.txt | cut -d" " -f1`)

prepare() {
    mkdir "${srcdir}/build"
}

build() {
    cd "${srcdir}/build"
    cmake "../${pkgbase}-${pkgver}" \
        -DCMAKE_BUILD_TYPE=${_build_type} \
        -DCMAKE_INSTALL_PREFIX=${_installprefix} \
        -DKDE4_BUILD_TESTS=ON \
        -DCMAKE_SKIP_RPATH=ON \
        -DKDEPIM_BUILD_MOBILE=OFF \
        -DCMAKE_{SHARED,MODULE,EXE}_LINKER_FLAGS='-Wl,--no-undefined -Wl,--as-needed'
    make
}

package_kdepim-akonadiconsole() {
    pkgdesc="Akonadi console"
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    depends=("${pkgbase}-common>=${pkgver}"
             "baloo-widgets>=${_kdever}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/akonadiconsole
    make DESTDIR="${pkgdir}" install
}

package_kdepim-akregator() {
    pkgdesc="Newsfeed client"
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('network')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/akregator
    make DESTDIR="${pkgdir}" install
    cd "${srcdir}"/build/kontact/plugins/akregator
    make DESTDIR="${pkgdir}" install
}

package_kdepim-blogilo() {
    pkgdesc='Blogging client'
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('network')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/blogilo
    make DESTDIR="${pkgdir}" install
    cd "${srcdir}"/build/composereditor-ng
    make DESTDIR="${pkgdir}" install
}

package_kdepim-console() {
    pkgdesc='Command line tool for accessing calendar files'
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('network')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/console
    make DESTDIR="${pkgdir}" install
}

package_kdepim-kaddressbook() {
    pkgdesc="Addressbook"
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('network')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    for i in kaddressbook kontact/plugins/kaddressbook \
    plugins/kaddressbook contactthemeeditor; do
        cd "${srcdir}"/build/${i}
        make DESTDIR="${pkgdir}" install
    done
}

package_kdepim-kalarm() {
    pkgdesc='Personal alarm scheduler'
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('accessories')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/kalarm
    make DESTDIR="${pkgdir}" install
}

package_kdepim-kjots() {
    pkgdesc='Note taker'
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('accessories')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/kjots
    make DESTDIR="${pkgdir}" install
    cd "${srcdir}"/build/kontact/plugins/kjots
    make DESTDIR="${pkgdir}" install
}

package_kdepim-kleopatra() {
    pkgdesc='Certificate manager and unified crypto GUI'
    depends=('kdepim-common')
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    install=${pkgbase}.install
    url="http://kde.org/applications/utilities/kleopatra/"

    cd "${srcdir}"/build/kleopatra
    make DESTDIR="${pkgdir}" install
}

package_kdepim-kmail() {
    pkgdesc="E-Mail client"
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('network')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    for i in kmail kmailcvt agents/archivemailagent storageservicemanager\
    agents/mailfilteragent importwizard ksendemail libksieve messagelist \
    kontact/plugins/kmail headerthemeeditor mboximporter; do
        cd "${srcdir}"/build/${i}
        make DESTDIR="${pkgdir}" install
    done
}

package_kdepim-knode() {
    pkgdesc="NNTP client"
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('network')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/knode
    make DESTDIR="${pkgdir}" install
    cd "${srcdir}"/build/kontact/plugins/knode
    make DESTDIR="${pkgdir}" install
}

package_kdepim-knotes() {
    pkgdesc="Sticky notes for your desktop"
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('accessories')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/knotes
    make DESTDIR="${pkgdir}" install
    cd "${srcdir}"/build/agents/notesagent
    make DESTDIR="${pkgdir}" install
    cd "${srcdir}"/build/kontact/plugins/knotes
    make DESTDIR="${pkgdir}" install
}

package_kdepim-kontact() {
    pkgdesc="Groupware client and shell for other PIM applications"
    groups=("${pkgbase}"
            "kde"
            "kde-uninstall")
    categories=('network')
    depends=("${pkgbase}-common>=${pkgver}")
    optdepends=("${pkgbase}-kmail>=${pkgver}"
                "${pkgbase}-akregator>=${pkgver}" 
                "${pkgbase}-kaddressbook>=${pkgver}"
                "${pkgbase}-kjots>=${pkgver}"
                "${pkgbase}-knotes>=${pkgver}" 
                "${pkgbase}-korganizer>=${pkgver}"
                "${pkgbase}-ktimetracker>=${pkgver}")
    install=${pkgbase}.install

    for i in kontact/src kontact/plugins/summary \
        kontact/plugins/specialdates; do
        cd "${srcdir}"/build/${i}
        make DESTDIR="${pkgdir}" install
    done
}

package_kdepim-korganizer() {
    pkgdesc='Calendar and scheduling program'
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('office')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    for i in korganizer korgac kontact/plugins/korganizer calendarviews; do
        cd "${srcdir}"/build/${i}
        make DESTDIR="${pkgdir}" install
    done
}

package_kdepim-kresources() {
    pkgdesc='KDE PIM resources'
    depends=("${pkgbase}-common>=${pkgver}")

    cd "${srcdir}"/build/kresources
    make DESTDIR="${pkgdir}" install
}

package_kdepim-ktimetracker() {
    pkgdesc="Time tracking software"
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('accessories')
    depends=("${pkgbase}-common>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/ktimetracker
    make DESTDIR="${pkgdir}" install
}

package_kdepim-ktnef() {
    pkgdesc='A viewer/extractor for TNEF files'
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    categories=('accessories')
    depends=("kdebase-runtime>=${pkgver}"
             "kdepimlibs>=${pkgver}")
    install=${pkgbase}.install

    cd "${srcdir}"/build/ktnef
    make DESTDIR="${pkgdir}" install
}

package_kdepim-common() {
    pkgdesc="KDE PIM common files and libraries"
    depends=("kdepimlibs>=${_kdever}"
             "kde-runtime>=${_kdever}"
             "chakra-common>=${_kdever}"
             "kdepim-runtime>=${_pkgver}"
             'libxss'
             'link-grammar'
             'pcre')
    groups=("kde"
            "${pkgbase}"
            "kde-uninstall")
    install=${pkgbase}.install

    for i in agents/sendlateragent akonadi_next calendarsupport \
    incidenceeditor-ng kaddressbookgrantlee kdgantt2 libkdepim \
    libkdepimdbusinterfaces libkleo libkpgp mailcommon mailimporter \
    messagecomposer messagecore messageviewer icons templateparser \
    plugins/messageviewer grammar grantleetheme grantleethemeeditor \
    plugins/ktexteditor pimactivity pimcommon pimsettingexporter; do
        cd "${srcdir}"/build/${i}
        make DESTDIR="${pkgdir}" install
    done
}
