#
# KDE SC Packages for Chakra, part of chakra-project.org
#
# maintainer (i686): Phil Miller <philm[at]chakra-project[dog]org>
# maintainer (x86_64): Manuel Tortosa <manutortosa[at]chakra-project[dot]org>

# include global config
source ../_buildscripts/${current_repo}-${_arch}-cfg.conf

#
# package info
#
pkgbase="kdepim"
pkgname=('kdepim-common'
         'kdepim-doc'
	 'kdepim-akonadiconsole'
         'kdepim-akregator'
         'kdepim-blogilo'
         'kdepim-kaddressbook'
         'kdepim-kalarm'
         'kdepim-kjots'
         'kdepim-kmail'
         'kdepim-knode'
         'kdepim-knotes'
         'kdepim-kontact'
         'kdepim-korganizer'
         'kdepim-ktimetracker'
         'kdepim-mobile'
         'kdepim-wizards')
   
arch=('i686' 'x86_64')
#pkgver=${_kdever}
pkgver=4.6.0
pkgrel=3
pkgdesc="split package"
url="http://www.kde.org"
license=('GPL' 'LGPL' 'FDL')
options=('!docs' '!splithdr' 'splitdbg' 'log')

makedepends=('pkgconfig' 'cmake' 'automoc4' 'boost' "kdelibs>=${_kdever}" "kdepimlibs>=${_kdever}"
             "kdepim-runtime" 'libxss' "kdebase-runtime" 
	     'kde-agent' 'libindicate-qt>=0.2.2' 'docbook-xml' 'dblatex')


source=($_mirror/${pkgbase}-${pkgver}.tar.bz2)
md5sums=('72396ca638233f52fcc69cac74fcc06d')

#
# build function
#
build()
{

	cd ${srcdir}/${pkgbase}-${pkgver}

	cmake . -DCMAKE_BUILD_TYPE=${_build_type} \
		-DCMAKE_INSTALL_PREFIX=${_installprefix} \
		-DCMAKE_SKIP_RPATH=ON \
		-DCMAKE_{SHARED,MODULE,EXE}_LINKER_FLAGS='-Wl,--no-undefined -Wl,--as-needed'

	make || return 1
}


#
# split-install functions
#
package_kdepim-common()
{
	pkgdesc="KDE PIM - Common files and libraries"
	depends=("kdepimlibs>=${_kdever}" 'libxss' "kdebase-runtime" 'kde-agent'
                 'libxss' 'libindicate-qt>=0.2.2' "kdepim-runtime>=${_pkgver}")
	groups=("kde" "kdepim" "kde" "kde-uninstall")
	install=${pkgbase}.install

	splitdirs="akonadi_next icons calendarsupport calendarviews console incidenceeditor-ng kdgantt2 kleopatra kresources ksendemail libkdepim libkdepimdbusinterfaces libkleo libkpgp libksieve mailcommon messagecore messagecomposer messagecore messagelist messageviewer nepomuk_email_feeder ontologies plugins strigi-analyzer templateparser"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done

	# FIXME: also exists in oxygen-icons
	rm -rf $pkgdir/usr/share/icons/oxygen/16x16/status/meeting-organizer.png
}

package_kdepim-doc()
{
	pkgdesc="KDE PIM - Documentation"
	groups=("${pkgbase}" "kde" "kde-doc" "kde-uninstall")

	splitdirs="doc"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-akonadiconsole()
{
	pkgdesc="Akonadi console"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="akonadiconsole"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-akregator()
{
	pkgdesc="Newsfeed client"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="akregator"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-blogilo()
{
	pkgdesc="Blogilo is a free/Open Source Blogging application, focused on simplicity and usability."
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="blogilo"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-kaddressbook()
{
	pkgdesc="Addressbook"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="kaddressbook"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-kalarm()
{
	pkgdesc="Alarm App + Daemon"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="kalarm"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-kitchensync()
{
	pkgdesc="Opensync synchronization gui"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}" 'libopensync')
	install=${pkgbase}.install

	splitdirs="kitchensync"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-kjots()
{
	pkgdesc="A small, handy program for keeping miscellaneous notes"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="kjots"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-kmail()
{
	pkgdesc="A full-featured E-Mail client"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="kmail kmailcvt"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-mobile()
{
	pkgdesc="Sync your mobile phone"
	groups=("kde-mobile")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="mobile"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-knode()
{
	pkgdesc="NNTP client"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="knode"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-knotes()
{
	pkgdesc="Sticky notes for your Desktop"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="knotes"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-kontact()
{
	pkgdesc="Groupware client and shell for other PIM applications"
	groups=("${pkgbase}" "kde" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}" "${pkgbase}-kmail>=${pkgver}" "${pkgbase}-akregator>=${pkgver}" "${pkgbase}-kaddressbook>=${pkgver}" 
"${pkgbase}-kjots>=${pkgver}" "${pkgbase}-knotes>=${pkgver}" "${pkgbase}-korganizer>=${pkgver}" "${pkgbase}-ktimetracker>=${pkgver}" "${pkgbase}-wizards>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="kontact"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-korganizer()
{
	pkgdesc="Organizer and Planner"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="korganizer"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done

	# remove conflict with kdebase-runtime
	rm -f ${pkgdir}/usr/share/icons/oxygen/32x32/actions/appointment-new.png
}

package_kdepim-ktimetracker()
{
	pkgdesc="Time tracking software"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="ktimetracker"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

package_kdepim-wizards()
{
	pkgdesc="KDE groupware wizards"
	groups=("kde" "${pkgbase}" "kde-uninstall")
	depends=("${pkgbase}-common>=${pkgver}")
	install=${pkgbase}.install

	splitdirs="wizards"
		for i in ${splitdirs} ; do
			cd ${srcdir}/${pkgbase}-${pkgver}/${i}
			make DESTDIR=${pkgdir} install || return 1
		done
}

